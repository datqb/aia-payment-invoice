window.CQ_Analytics||(window.CQ_Analytics={});
(function(z,m){m.mboxes=m.mboxes||[];var l=function(n,h){function k(a){A&&console.log(a)}function B(a){try{var b=n.ajax;try{0===a.indexOf("/")&&q&&0!==a.indexOf(q+"/")&&(a=q+a)}catch(d){}var c=b.call(n,{type:"GET",url:a,async:!1,externalize:!1,encodePath:!1,hook:!1});return c?c:null}catch(d){return null}}function u(){var a=CQ.shared.HTTP.getPath(top.document.location.href),b=navigator?navigator.userAgent.toLowerCase():"other";if(0<b.indexOf("trident/")){var c=b.indexOf("rv:");if("11"==parseInt(b.substring(c+
3,b.indexOf(".",c)),10))return-1<a.indexOf("/editor.html/")}return a.includes("/editor.html/")}function C(a){var b=CQ.shared.HTTP.getParameter(document.location.href,"wcmmode");u()&&(b="disabled");b&&0<b.length&&(a=CQ.shared.HTTP.addParameter(a,"wcmmode",b));return a}function v(a,b){a=C(a);var c=B(window.targetGlobalSettings.currentPagePath+".targetoffer.html"+a),d=c&&c.responseText&&0<c.responseText.length;if(c&&c.status&&200===c.status&&d){d=document.getElementById(b);var f=!1;if(d){for(;d.firstChild;)d.removeChild(d.firstChild);
f=d.getElementsByTagName("div");1===f.length&&(d=f[0]);f=document.createElement("div");f.innerHTML=c.responseText;d.appendChild(f);f=d.getElementsByTagName("script");for(var g=0;g<f.length;g++)eval(f[g].text);f=!0;if(d=d.parentElement)g=document.createEvent("CustomEvent"),g.initEvent("target-dom-loaded",!0,!1),g.mboxName=b,d.dispatchEvent(g)}f||document.write(c.responseText)}}function p(){for(var a=0;a<h.mboxes.length;a++){var b={};Array.isArray(h.mboxes[a].staticParameters)&&h.mboxes[a].staticParameters.map(function(r,
w){var t=r.split("\x3d");2===t.length&&(b[t[0]]=t[1])});for(var c=0;c<CQ_Analytics.mboxes[a].mappings.length;c++){var d="",f=CQ_Analytics.mboxes[a].mappings[c].param,g="/"+h.mboxes[a].mappings[c].ccKey.replace(".","/");-1<h.mboxes[a].isProfile.indexOf(f)&&(d="profile.");g=h.DataProvider.replaceVariables(D(g));b[d+f]="undefined"!==typeof g?g:""}h.mboxes[a].includeResolvedSegments&&h.SegmentMgr&&0<h.SegmentMgr.getResolved().length&&(b["profile._cq_.resolvedSegments"]="|"+h.SegmentMgr.getResolved().join("|")+
"|");(function(r,w){setTimeout(function(){CQ_Analytics.TestTarget.updateMboxContent(r,w)},0<a?100:0)})(h.mboxes[a].name,b)}}function D(a){var b=void 0;(a=window.ContextHub?ContextHub.get(a):h.ClientContext.get(a))&&(Array.isArray(a)?b=a.join(","):"object"!==typeof a&&(b=a));return b}function x(){var a=[];if(window.CQ_Analytics&&window.CQ_Analytics.TestTarget&&window.CQ_Analytics.TestTarget.mappings)for(var b in window.CQ_Analytics.TestTarget.mappings)a.push(b);return a}function E(){if("undefined"!==
typeof CQ&&CQ.WCM&&CQ.utils&&CQ.utils.WCM)return CQ.WCM.isPreviewMode()||CQ.utils.WCM.isEditMode();var a=(document.cookie||"").split(/;\s*/).reduce(function(b,c){var d=c.match(/([^=]+)=(.*)/);d&&(b[d[1]]=unescape(d[2]));return b},{});return"undefined"===typeof a.wcmmode||"preview"===a.wcmmode||"edit"===a.wcmmode}function y(){var a=document.querySelector('[class*\x3d"aem-AuthorLayer"]');return a?a.className.match("aem-AuthorLayer-[^ ]+")[0]:null}var F=/^(?:http|https):\/\/[^/]+(\/.*)\/(?:etc\.clientlibs|etc(\/.*)*\/clientlibs|libs(\/.*)*\/clientlibs|apps(\/.*)*\/clientlibs|etc\/designs).*\.js(\?.*)?$/,
e={};if(this.constructor===l.prototype)throw"This is a singleton!";if(l.instance)return l.instance;l.instance=e;var A=-1!==window.location.href.indexOf("debug-mbox-calls\x3d1"),q=function(){try{if(window.CQURLInfo)return CQURLInfo.contextPath||"";for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=F.exec(a[b].src);if(c)return c[1]}}catch(d){}return""}();e.registeredCHListeners={};e.usedStoresLoaded=!1;e.defaults={};e.mappings=[];e.maxProfileParams=200;e.pull=function(a,b,c){"undefined"===
typeof c&&(a=a.replace(/(\/content\/campaigns\/.*?)\/(.*)/,"$1/master/$2"));v(a,b)};e.displayOffer=function(a,b){adobe.target.getOffer({mbox:a,params:b,success:function(c){adobe.target.applyOffer({mbox:a,selector:"#"+a,offer:c})},error:function(c,d){console.error(c,d);n("#"+a).css("visibility","visible")}})};e.updateMboxContent=function(a,b){k("Updating content for mbox "+a);if(u()){var c=y();c?"aem-AuthorLayer-Edit"===c?e.signalDefaultOffer(a):e.displayOffer(a,b):setTimeout(function(){e.updateMboxContent(a,
b)},100)}else e.displayOffer(a,b)};e.registerMboxUpdateCalls=function(){"undefined"!==typeof window.CQ_Analytics&&window.CQ_Analytics.TestTarget.mappings&&(k("[Target][init] Registering Mbox update calls"),0<x().length?e.registerContextHubListeners():p())};e.registerContextHubListeners=function(){if(window.ContextHub){for(var a=x(),b=[],c=0;c<a.length;c++){var d=a[c],f=d.split(".")[0];d="/"+d.replace(".","/");ContextHub.get(f)&&!e.registeredCHListeners[f]&&(e.registeredCHListeners[f]=!0,b.push(d),
k("[Target][CH] - Listening for updates on "+d+" CH"))}0<b.length&&ContextHub.bind(b,function(g){k("[Target][CH][registerContextHubListeners] All properties available, triggering update!");p();e.usedStoresLoaded=!0},function(g){k("[Target][CH][registerContextHubListeners] Not all properties available, triggering update!");e.usedStoresLoaded||p()},500)}};e.addMbox=function(a){var b=!1,c=!1;CQ_Analytics.mboxes||(CQ_Analytics.mboxes=[]);for(var d=0;d<CQ_Analytics.mboxes.length;d++){var f=CQ_Analytics.mboxes[d];
if(f.id===a.id){CQ_Analytics.mboxes.splice(d,1);b=!0;c=f.defined;break}}a.defined=c;h.mboxes.push(a);a=a.mappings;for(c=0;c<a.length;c++)d=a[c].ccKey,e.mappings[d]||(e.mappings[d]={});return b};e.triggerUpdate=function(a){"undefined"===typeof a&&(a=500);e.reloadRequested||(e.reloadRequested=!0,setTimeout(function(){var b=y();("aem-AuthorLayer-Edit"===b||"aem-AuthorLayer-Preview"===b||E())&&p();e.reloadRequested=!1},a))};e.signalDefaultOffer=function(a){"undefined"===typeof e.defaults[a]?console&&
console.log("The default offer path was not found in the internal map for mbox "+a):(v(e.defaults[a],a),n("#"+a).css("visibility","visible"))};return e};m.TestTarget=l(z,m);top.$(top.document).on("editor-frame-mode-changed",function(){CQ_Analytics&&CQ_Analytics.TestTarget&&CQ_Analytics.TestTarget.triggerUpdate()})})($,window.CQ_Analytics);